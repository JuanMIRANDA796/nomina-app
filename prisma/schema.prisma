// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Employee {
  id          Int          @id @default(autoincrement())
  name        String
  cedula      String       @unique
  cargo       String
  salary      Float
  riskClass   String       @default("I") // I, II, III, IV, V
  status      String       @default("ACTIVE") // ACTIVE, INACTIVE
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  attendances Attendance[]
  absences    Absence[]
}

model Attendance {
  id         Int       @id @default(autoincrement())
  employeeId Int
  employee   Employee  @relation(fields: [employeeId], references: [id])
  date       DateTime  // The date of the shift (without time)
  entryTime  DateTime? // Full timestamp
  exitTime   DateTime? // Full timestamp
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([employeeId])
  @@index([date])
  @@unique([employeeId, date])
}

model Absence {
  id          Int      @id @default(autoincrement())
  employeeId  Int
  employee    Employee @relation(fields: [employeeId], references: [id])
  date        DateTime
  reason      String   // e.g., "Incapacidad m√©dica", "Vacaciones"
  paidPercentage Float @default(0) // 0.0 to 1.0 (e.g. 0.6667)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([employeeId, date])
}

model Holiday {
  id        Int      @id @default(autoincrement())
  date      DateTime @unique
  name      String
}

model PayrollConfig {
  id          Int      @id @default(autoincrement())
  key         String   @unique // e.g., "AUX_TRANSPORTE", "SMLV"
  value       String   // e.g., "162000"
  description String?
}

model PresentationSlide {
  id        Int      @id @default(autoincrement())
  slug      String   @unique // e.g. "slide-1-intro", "slide-2-history"
  title     String
  type      String   // "text", "chart-bar", "chart-line", "heatmap"
  content   String?  // Markdown text for text slides
  data      Json?    // Flexible JSON structure for charts: [{ name: "2020", value: 100 }]
  order     Int      @default(0)
  updatedAt DateTime @updatedAt
}
model PresentationSnapshot {
  id        String   @id @default(cuid())
  data      Json     // Aggregated data for all slides
  createdAt DateTime @default(now())
}
